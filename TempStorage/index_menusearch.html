<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>chat</title>
    <!-- <link rel="stylesheet" href="mini_1.css"> -->
    <style>
        #questioninput {
            overflow: auto;
            width: 300px;
            height: 100px;
        }
        #questionBtn{
            width: 100px;
            height: 100px;
        }
        table{
            border: solid black 2px;
        }
        tr{
            border: solid black 2px;
        }
        td{
            border: solid black 2px;
        }
        #menucom{
            border: solid black 2px;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        #reciepe{
            border: solid black 2px;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        #result{
            border: solid black 2px;
            margin-top: 10px;
            margin-bottom: 10px;
        }
    </style>
  </head>
  <body>
    <!-- <div id="main">
        <section id="testfield">
            <article id="testArticle"></article>
            <article id="testFunction">
                <button onclick="listappend()">리스트로 추가</button>
            </article>
        </section>
        <section id="menucom">
            <table id="menutap">
                <thead>
                    <tr>
                        <td colspan="3">준비된 재료</td>
                        <td>요리의주제</td>
                        <td>기능 사용 방법</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" name="" id="ing1" class="ingrediant" placeholder="재료를 입력해주세요"></td>
                        <td></td>
                        <td></td>
                        <td rowspan="3"><select name="시간" id="">
                            <option value="">아침</option>
                            <option value="">점심</option>
                            <option value="">간식</option>
                            <option value="">저녁</option>
                            <option value="">야식</option>
                        </select></td>
                        <td rowspan="6">
                            <ul>
                                <li>기본적으로 2개의 input으로 재료 선정</li>
                                <li>추가버튼을 누르면 input을 1개 증가하고<br>추가는 아래로 제거버튼생성</li>
                                <li>요리의 주제 상단은 식사 시간 선택</li>
                                <li>요리의 주제 하단은 메뉴의 스타일선택</li>
                                <li>결과는 result에서 list or table로 출력</li>
                                <li></li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td><input type="text" name="" id="ing2" class="ingrediant" placeholder="재료를 입력해주세요"></td>
                        <td><button onclick="">추가</button></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="" id="ing3" class="ingrediant" placeholder="재료를 입력해주세요"></td>
                        <td></td>
                        <td><button onclick="">제거</button></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="" id="ing4" class="ingrediant" placeholder="재료를 입력해주세요"></td>
                        <td></td>
                        <td><button onclick="">제거</button></td>
                        <td rowspan="3"><select name="테마" id="">
                            <option value="">한식</option>
                            <option value="">일식</option>
                            <option value="">중식</option>
                            <option value="">양식</option>
                            <option value="">남미식</option>
                        </select></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="" id="ing5" class="ingrediant" placeholder="재료를 입력해주세요"></td>
                        <td></td>
                        <td><button onclick="">제거</button></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="" id="ing5" class="ingrediant" placeholder="재료를 입력해주세요"></td>
                        <td><button onclick="">추가</button></td>
                        <td><button onclick="">제거</button></td>
                    </tr>
                </tbody>
            </table>
        </section>
        <section id="recipetap">
            <p>이 곳은 레시피를 검색하는 section입니다</p>
            <p>메뉴추천을 이용해서 넘어 올 경우 추천된 메뉴의 목록이 나열</p>
            <p>각각의 메뉴를 선택하면 결과창에서 메뉴의 레시피를 보여줍니다</p>
            <p>메뉴추천을 이용하지 않고 탭을 이동 할 경우에는</p>
            <p>요리의 주제에 따라 특정 갯수의 메뉴를 랜덤하게 반환</p>
        </section>
        <section id="result">
            <p>이 곳은 각 탭의 기능에 따라 서로 다른 결과를 출력</p>
            <p>메뉴추천 탭에서 결과를 반환하면 주어진 조건에 따른 메뉴의 목록</p>
            <p>레시피 탭에서 결과를 반환하면 지정된 메뉴의 레시피를 출력</p>
            <p>메뉴추천탭의 결과와 레시피탭의 결과를 출력할 결과는 구상 중</p>
        </section>
        <div name="구현기능 정리">
            <ol>
                <li>메뉴추천탭의 데이터의 흐름과 화면상 기능의 스크립트 구현</li>
                <li>메뉴추천탭의 구성은 임시로 테이블로 구현했지만 이를 개선 시도</li>
                <li>레시피탭의 구성의 구체적인 구현</li>
                <li>두 탭 간의 이동에 따른 html 변환 코드 구현</li>
                <li>결과창에 출력할 데이터의 양식을 정리하고 시각적 구분</li>
                <li>메뉴탭의 결과창의 레시피목록을 레시피탭에서 출력</li>
                <li>구현된 기능들의 상호작용 확인 및 보완</li>
                <li>CSS, BootStrap, Tailwind 등을 통해 1차 디자인 구현</li>
                <li>전체기능을 테스트하고 CSS의 수정포인트 정리</li>
                <li>전체적인 코드 구성 정리</li>
                <li>ex:추가하면 좋을 것 같은 기능을 추가로 구상하고 테스트</li>
            </ol>
        </div>
    </div> -->
    <div>
        <section id="answerArea">
            <ul></ul>
        </section>
      <form action="post" id="questionArea">
        <input type="textarea" id="questioninput" autofocus />
        <button type="submit" id="questionBtn">질문</button>
      </form>
    </div>
    <script>
        const $메뉴탭 = document.querySelector("menutap");
        const $레시피탭 = document.querySelector("recipetap");
        const $결과창 = document.querySelector("resultap");
        const testArea = document.querySelector("testArticle");
        const $testfunc = document.querySelector("testFunction");
        const $form = document.querySelector("form");
        const $input = document.querySelector("input");
        const $chatList = document.querySelector("ul");


        
        // let tempul = document.createElement("ul")
        // tempul.classList.add("id", "listaddtest");
        // testArea.textContent = "안녕하세요";
        // testArea.appendChild(tempul);

        // function listappend(){

        //     let addlist = document.createElement("li");

        //     addlist.classList("id", "test");
        //     addlist.textContent = "테스트리스트 생성 중";
        //     // addlist.setAttribute("text", "<input type="+"text"+"class="+"ingrediant"+" placeholder="+"재료를 입력해주세요"+">");
        //     console.log("리스트테스트");

        //     tempul.appendChild(addlist);

        // }

        const inputtmp = document.querySelector("input")
        // openAI API
        let url = `https://estsoft-openai-api.jejucodingcamp.workers.dev/`;

        // 사용자의 질문
        let question;

        // 질문과 답변 저장
        let data = [
        {
            role: "system",
            content: "assistant는 친절한 답변가이다.",
        },
        ];

        // 화면에 뿌려줄 데이터, 질문들
        let questionData = [];

        // input에 입력된 질문 받아오는 함수
        $input.addEventListener("input", (e) => {
        question = e.target.value;
        });

        // 사용자의 질문을 객체를 만들어서 push
        const sendQuestion = (question) => {
        if (question) {
            data.push({
            role: "user",
            content: question,
            });
            questionData.push({
            role: "user",
            content: question,
            });
        }
        };

        // 화면에 질문 그려주는 함수
        const printQuestion = async () => {
        if (question) {
            let li = document.createElement("li");
            li.classList.add("question");
            questionData.map((el) => {
            li.innerText = el.content;
            });
            $chatList.appendChild(li);
            questionData = [];
            question = false;
        }
        };

        // 화면에 답변 그려주는 함수
        const printAnswer = (answer) => {
        let li = document.createElement("li");
        li.classList.add("answer");
        li.innerText = answer;
        $chatList.appendChild(li);
        };

        // api 요청보내는 함수
        const apiPost = async () => {
        const result = await fetch(url, {
            method: "POST",
            headers: {
            "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
            redirect: "follow",
        })
            .then((res) => res.json())
            .then((res) => {
            printAnswer(res.choices[0].message.content);
            })
            .catch((err) => {
            console.log(err);
            });
        };

        // submit
        $form.addEventListener("submit", (e) => {
        e.preventDefault();
        $input.value = null;
        sendQuestion(question);
        apiPost();
        printQuestion();
        });
    </script>
  </body>
</html>